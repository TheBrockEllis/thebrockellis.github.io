<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Trouble cURLing Myself</title>
<meta name="viewport" content="width=device-width">

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/css/pygment_trac.css" />
<link rel="stylesheet" href="/assets/css/syntax.css" />
<link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
<link rel="stylesheet" href="/assets/css/syntax.css">
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/timeline.css" />
<link rel="stylesheet" href="/assets/css/custom.css" />

</head>
<body  data-current-page="/2014/03/04/Trouble-cURLing-Myself">    
    <div class="container">
        <div id="header">
    <ul class="nav nav-pills pull-right">
        <li data-page-id="home"><a href="/">Home</a></li>
        <li data-page-id="about"><a href="/about.html">About</a></li>
        <li data-page-id="portfolio"><a href="/portfolio.html">Porfolio</a></li>
        <li data-page-id="contact"><a href="/contact.html">Contact</a></li>
        <li data-page-id="blog"><a href="/blog/">Blog</a></li>
    </ul>
    <h1 class="title">
        <a href="/">
            <img src="/assets/img/thebrockellis.jpg" title="My mug shot" id='mugshot' />
            <span class='the'>The</span>BrockEllis
        </a>
    </h1>
</div>

        <div class="row">
    <div class="col-md-2 col-md-offset-1 blog-meta">
        <img src="/blog/img/2014-03-04.jpg" title="Trouble cURLing Myself" class='blog-meta-image img-responsive img-thumbnail' />
        <div class="blog-meta-posted"> 04 Mar 2014 <i class="icon-calendar"></i> </div>
        <div class="blog-meta-author"> Brock Ellis <i class="icon-user"></i> </div>
        <div class="blog-meta-categories">
            
                <span class='blog-meta-category'> code <i class="icon-tag"></i> </span>
            
                <span class='blog-meta-category'> work <i class="icon-tag"></i> </span>
            
        </div>
    </div>
    <div class="col-md-9 blog-content">
        <h2>Trouble cURLing Myself</h2>
        <div class="post">
            <p>tl;dr Code, debug, research, debug some more and then get help</p>

<h2 id="background">Background</h2>
<p>A few days ago I was working with our soon-to-be-public-facing API trying to finish our integration with OAuth2. Moving to OAuth means that it would now be impossible to test the API via a web browser. To help out the new testing, I had downloaded a little Java PC program that allowed me to set up requests, set custom headers and change the HTTP methods used. The application worked awesome, but it was still a little clunky and not as nice as using the address bar in my browser. So I set out to do what every web dev would do: build a web interface to the API.</p>

<p>I had seen the idea a few other places: build a ‘console’ where users can set their access token and test out API calls without actually having to code anything. My biggest inspiration was the Google OAuth Playground which I used quite a bit early on.</p>

<p>The basic layout of the console (which I named ‘the Sandbox’) was a simple web form on the left hand side of the page and the results of the test calls on the right hand side. The form would submit the data and I would use cURL to send the test request and then display the results. I set up all the UI stuff and started on hooking up the backend and ran into some problems.</p>

<h2 id="problem">Problem</h2>
<p>I was trying to cURL the ‘/Me’ endpoint on our API which just returns some basic information about your specific user. I had written some very similar code a few weeks ago but despite my best efforts, I could not get it to work. There was some inconsistency afoot. When using the PHP cURL library, it failed. Request didn’t even make it out the door. When I tried via a web browser it came back with HTTP 401, which was exactly what I was expecting. Two methods of access and two different results- let the debugging commence.</p>

<p>I started on the command line, trying to curl the endpoint. Nothing. I tried adding the verbose flag (–verbose) to the curl command line request and it came back with the following:</p>

<figure class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre>* About to connect() to dev.sycamoreeducation.com port 80
* Trying 198.101.164.71... connected
* Connected to xxx.redacted.com (555.555.555.555) port 80
&gt; GET /api/v1.0/Me HTTP/1.1
&gt; User-Agent: curl/7.15.5 (x86_64-redhat-linux-gnu) libcurl/7.15.5 OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5
&gt; Host: xxx.redacted.com
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 26 Feb 2014 17:01:09 GMT
&lt; Server: Apache
&lt; Content-Length: 0
&lt; Content-Type: text/html; charset=UTF-8
* Connection #0 to host xxx.redacted.com left intact
* Closing connection #0<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Ok, I can now see a response (HTTP 200 OK) which is nice even though it wasn’t what I was expecting. Then I wondered if our API was doing some sort of redirect that the curl request couldn’t handle so I set the location flag (-L) on the curl request. Still nothing.</p>

<p>At this point I had been banging my head against this for a few hours and I decided that I was best served moving onto something else. I let it rest for a day and moved onto more productive things.</p>

<h2 id="solution">Solution</h2>
<p>A few days went by and I brought it up to one of our sysadmins: ‘Any idea why I wouldn’t be able to execute a cURL call on the same domain it originates from?’. He sat down, typed a few characters and asked me to try it again. It worked. Son of a bitch, it worked. The problem was one of the host files for the server was pointing to the wrong virtual IP address. A little reconfiguration and bippity-boppity boo it all worked.</p>

<p>I know it would have been nice to glean some piece of knowledge out of this whole situation, but maybe what I can pass on is that there is definitely value in having an experienced and knowledgeable sysadmin on your team. Try to code something every way you know how, exhaust all debugging options, and then find someone who may know something you don’t and ask them.</p>

        </div>
        
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname    = "thebrockellis";
                var disqus_title        = "Trouble cURLing Myself";
                var disqus_url          = "http://thebrockellis.com/2014/03/04/Trouble-cURLing-Myself";

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        
    </div>
</div>


        <div class="row" id="footer">
    <div class="col-md-4">
        <span class="the">The</span> Brock Ellis
    </div>
    <div class="col-md-4">
        Jack of all trades, master of none
    </div>
    <div class="col-md-4">
        brock[at]sharproot[dot]com
    </div>
</div>

<SCRIPT type="text/javascript" src="//code.jquery.com/jquery.js"></SCRIPT>
<SCRIPT type="text/javascript">
$(document).ready(function(){
    // highlight current page
    var currentPage = $("body").data("current-page");
    if (currentPage) {
        $("li[data-page-id='" + currentPage + "']").addClass("active");
    }
});
</SCRIPT>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35551321-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </div>
</body>
</html>
